<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SHM: test1.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SHM
   </div>
   <div id="projectbrief">共有メモリを用いた高速で扱いやすいプロセス間通信マネージャ</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">test1.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>共有メモリに関するテスト</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="shm__pub__sub_8hpp.html">shm_pub_sub.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;shm_pub_sub_vector.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;test1.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEFAULT_NAME  &quot;/test&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// *******************************************************************</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">writing(std::string name)</div>
<div class="line">{</div>
<div class="line">  ClassTest test;</div>
<div class="line">  <a name="_a0"></a><a class="code" href="classirlab_1_1shm_1_1_publisher.html">irlab::shm::Publisher&lt;ClassTest&gt;</a> pub(name);</div>
<div class="line">  std::vector&lt;ClassTest&gt; test_vector(3);</div>
<div class="line">  <a class="code" href="classirlab_1_1shm_1_1_publisher.html">irlab::shm::Publisher&lt;std::vector&lt;ClassTest&gt;</a>&gt; pub_vector(<span class="stringliteral">&quot;test_vector&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; i++)</div>
<div class="line">  {</div>
<div class="line">    test.a = i;</div>
<div class="line">    test.b = test.a+test.b;</div>
<div class="line">    test.c[0] = test.b/(test.b+1);</div>
<div class="line">    test.c[1] = test.b-test.c[0];</div>
<div class="line">    test.c[2] = test.b*test.c[0];</div>
<div class="line">    test.c[3]++;</div>
<div class="line">    test.c[4]--;</div>
<div class="line"> </div>
<div class="line">    test_vector.resize(i/3+3);</div>
<div class="line">    test_vector[0] = test;</div>
<div class="line">    test_vector[1].a = test.a * i;</div>
<div class="line">    test_vector[1].b = test.b * i;</div>
<div class="line">    test_vector[1].c[0] = test.c[0] * i;</div>
<div class="line">    test_vector[1].c[1] = test.c[1] * i;</div>
<div class="line">    test_vector[1].c[2] = test.c[2] * i;</div>
<div class="line">    test_vector[1].c[3] = test.c[3] * i;</div>
<div class="line">    test_vector[1].c[4] = test.c[4] * i;</div>
<div class="line">    test_vector[2].a = test.a * i;</div>
<div class="line">    test_vector[2].b = test.b * i;</div>
<div class="line">    test_vector[2].c[0] = test.c[0] * i;</div>
<div class="line">    test_vector[2].c[1] = test.c[1] * i;</div>
<div class="line">    test_vector[2].c[2] = test.c[2] * i;</div>
<div class="line">    test_vector[2].c[3] = test.c[3] * i;</div>
<div class="line">    test_vector[2].c[4] = test.c[4] * i;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;write: test.a =\t&quot;</span> &lt;&lt; test.a &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;write: test.b =\t&quot;</span> &lt;&lt; test.b &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; 5; index++)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;write: test.c[&quot;</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot;] =\t&quot;</span> &lt;&lt; test.c[index] &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vector_index = 0; vector_index &lt; 3; vector_index++)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;write: test_vector[&quot;</span> &lt;&lt; vector_index &lt;&lt; <span class="stringliteral">&quot;].a =\t&quot;</span> &lt;&lt; test_vector[vector_index].a &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;write: test_vector[&quot;</span> &lt;&lt; vector_index &lt;&lt; <span class="stringliteral">&quot;].b =\t&quot;</span> &lt;&lt; test_vector[vector_index].b &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; 5; index++)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;write: test_vector[&quot;</span> &lt;&lt; vector_index &lt;&lt; <span class="stringliteral">&quot;].c[&quot;</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot;] =\t&quot;</span> &lt;&lt; test_vector[vector_index].c[index] &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pub.<a name="a1"></a><a class="code" href="classirlab_1_1shm_1_1_publisher.html#abaac5554b1e838c1069858ca3ca0fde0">publish</a>(test);</div>
<div class="line">    pub_vector.<a class="code" href="classirlab_1_1shm_1_1_publisher.html#abaac5554b1e838c1069858ca3ca0fde0">publish</a>(test_vector);</div>
<div class="line">    </div>
<div class="line">    sleep(1);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">reading(std::string name)</div>
<div class="line">{</div>
<div class="line">  <a name="_a2"></a><a class="code" href="classirlab_1_1shm_1_1_subscriber.html">irlab::shm::Subscriber&lt;ClassTest&gt;</a> sub(name);</div>
<div class="line">  <a class="code" href="classirlab_1_1shm_1_1_subscriber.html">irlab::shm::Subscriber&lt;std::vector&lt;ClassTest&gt;</a>&gt; sub_vector(<span class="stringliteral">&quot;test_vector&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 5; i++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">bool</span> is_success;</div>
<div class="line">    sub.waitFor(2000000); <span class="comment">/* 2.0[sec]*/</span></div>
<div class="line">    <span class="keyword">auto</span> test = sub.subscribe(&amp;is_success);</div>
<div class="line">    <span class="keywordflow">if</span> (is_success == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;subscribe failed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;read: test.a =\t&quot;</span> &lt;&lt; test.a &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;read: test.b =\t&quot;</span> &lt;&lt; test.b &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; 5; index++)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;read: test.c[&quot;</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot;] =\t&quot;</span> &lt;&lt; test.c[index] &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> test_vector = sub_vector.subscribe(&amp;is_success);</div>
<div class="line">    <span class="keywordflow">if</span> (is_success == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;subscribe vector failed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }  </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> vector_index = 0; vector_index &lt; test_vector.size(); vector_index++)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;read: test_vector[&quot;</span> &lt;&lt; vector_index &lt;&lt; <span class="stringliteral">&quot;].a =\t&quot;</span> &lt;&lt; test_vector[vector_index].a &lt;&lt; std::endl;</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;read: test_vector[&quot;</span> &lt;&lt; vector_index &lt;&lt; <span class="stringliteral">&quot;].b =\t&quot;</span> &lt;&lt; test_vector[vector_index].b &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; 5; index++)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;read: test_vector[&quot;</span> &lt;&lt; vector_index &lt;&lt; <span class="stringliteral">&quot;].c[&quot;</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot;] =\t&quot;</span> &lt;&lt; test_vector[vector_index].c[index] &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">usage(<span class="keywordtype">char</span> *prog_name)</div>
<div class="line">{</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Usage: %s {-w|-r} {-k name|-K name}\n&quot;</span>, prog_name);</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;options:\n&quot;</span>);</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;\t-w\t\texecute the writing\n&quot;</span>);</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;\t-r\t\texecute the reading\n&quot;</span>);</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;\t-k name\t\tset the shm name\n&quot;</span>);</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;\t-K name\t\tkill shared memory\n&quot;</span>);</div>
<div class="line">  exit(1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  std::string name = DEFAULT_NAME;</div>
<div class="line">  <span class="keywordtype">int</span> opt, flag = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (argc == 1) </div>
<div class="line">  {</div>
<div class="line">    usage(argv[0]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">do</span> </div>
<div class="line">  {</div>
<div class="line">    opt = getopt(argc, argv, <span class="stringliteral">&quot;wrk:K:h?&quot;</span>);</div>
<div class="line">    <span class="keywordflow">switch</span> (opt) </div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line">      flag = 1;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">      flag = 2;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>:</div>
<div class="line">      name = optarg;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;K&#39;</span>:</div>
<div class="line"><span class="comment">//      shmRemoveKey(optarg);</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div>
<div class="line">      usage(argv[0]);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">while</span> (opt &gt; 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (flag) </div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      writing(name);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> 2:</div>
<div class="line">      reading(name);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassirlab_1_1shm_1_1_publisher_html"><div class="ttname"><a href="classirlab_1_1shm_1_1_publisher.html">irlab::shm::Publisher</a></div><div class="ttdoc">共有メモリにトピックを出力する出版者を表現するクラス</div><div class="ttdef"><b>Definition:</b> <a href="shm__pub__sub_8hpp_source.html#l00059">shm_pub_sub.hpp:60</a></div></div>
<div class="ttc" id="aclassirlab_1_1shm_1_1_publisher_html_abaac5554b1e838c1069858ca3ca0fde0"><div class="ttname"><a href="classirlab_1_1shm_1_1_publisher.html#abaac5554b1e838c1069858ca3ca0fde0">irlab::shm::Publisher::publish</a></div><div class="ttdeci">void publish(const T &amp;data)</div><div class="ttdoc">トピックの書き込み</div><div class="ttdef"><b>Definition:</b> <a href="shm__pub__sub_8hpp_source.html#l00183">shm_pub_sub.hpp:183</a></div></div>
<div class="ttc" id="aclassirlab_1_1shm_1_1_subscriber_html"><div class="ttname"><a href="classirlab_1_1shm_1_1_subscriber.html">irlab::shm::Subscriber</a></div><div class="ttdoc">共有メモリからトピックを取得する購読者を表現するクラス</div><div class="ttdef"><b>Definition:</b> <a href="shm__pub__sub_8hpp_source.html#l00094">shm_pub_sub.hpp:95</a></div></div>
<div class="ttc" id="ashm__pub__sub_8hpp_html"><div class="ttname"><a href="shm__pub__sub_8hpp.html">shm_pub_sub.hpp</a></div><div class="ttdoc">出版/購読モデルによるトピック通信を規定するクラスの定義</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jul 6 2025 00:08:40 for SHM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
